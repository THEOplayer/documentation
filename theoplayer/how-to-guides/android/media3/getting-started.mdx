import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Getting started with Media3 on Android

The THEOplayer Android Media3 pipeline is a new integration within our Android SDK that handles the playback of video and audio files.
It is based on the [Jetpack Media3](https://developer.android.com/media/media3), and
it provides a more stable playback covering vaster device specific requirements, all while being lighter in size.

## Usage

1. Follow [our Getting Started guide](../../../getting-started/01-sdks/02-android/00-getting-started.mdx)
   to set up THEOplayer in your Android app.
2. Add the Media3 integration as a dependency in your module-level `build.gradle` file.
3. Add the Media3 integration to the player.

### Add the Media3 integration dependency

Add the Media3 integration as a dependency in your module-level `build.gradle` file:

<Tabs queryString="lang">
  <!-- prettier-ignore-start -->
  <TabItem value="groovy" label="Groovy">
    ```groovy
    dependencies {
      implementation "com.theoplayer.theoplayer-sdk-android:core:8.+"
      // highlight-next-line
      implementation "com.theoplayer.theoplayer-sdk-android:integration-media3:8.+"
    }
    ```
  </TabItem>
  <TabItem value="kotlin" label="Kotlin">
    ```kotlin
    dependencies {
      implementation("com.theoplayer.theoplayer-sdk-android:core:8.+")
      // highlight-next-line
      implementation("com.theoplayer.theoplayer-sdk-android:integration-media3:8.+")
    }
    ```
  </TabItem>
  <!-- prettier-ignore-end -->
</Tabs>

### Add the Media3 integration to the player

To make use of the Media3 integration, create and add the `Media3PlayerIntegration` to your `THEOplayerView`:

```kotlin
val media3PlayerIntegration = Media3PlayerIntegration.createMedia3PlayerIntegration();
theoplayerView.player.addIntegration(media3PlayerIntegration);
```

From the moment the Media3PlayerIntegration is added, all subsequent sources set will use our Media3 pipeline to play.

<Tabs queryString="lang">
  <!-- prettier-ignore-start -->
  <TabItem value="kotlin" label="Kotlin">
    ```kotlin
    val typedSource = TypedSource
    .Builder("https://cdn.theoplayer.com/video/dash/big_buck_bunny/BigBuckBunny_10s_simple_2014_05_09.mpd")
    .type(SourceType.DASH)
    .build()

    val sourceDescription = SourceDescription
    .Builder(typedSource)
    .build()

    theoPlayerView.player.source = sourceDescription
    ```

  </TabItem>
  <TabItem value="java" label="Java">
    ```java
    TypedSource typedSource = new TypedSource
    .Builder("https://cdn.theoplayer.com/video/dash/big_buck_bunny/BigBuckBunny_10s_simple_2014_05_09.mpd")
    .type(SourceType.DASH)
    .build();

    SourceDescription sourceDescription = new SourceDescription
    .Builder(typedSource)
    .build();

    theoPlayerView.getPlayer().setSource(sourceDescription);
    ```
  </TabItem>
  <!-- prettier-ignore-end -->
</Tabs>

By default, the `Media3PlayerIntegration` will play all types of sources except HESP and Millicast.
To modify the default behaviour, it's possible to pass an implementation of the `Media3PlayerIntegration.SourceSelectCallback`
interface while creating the Integration.

```kotlin
val media3PlayerIntegration = createMedia3PlayerIntegration(Media3PlayerIntegration.SourceSelectCallback { selectedSource, source ->
    // selectedSource -> represents the TypedSource the player picked to play.
    // source -> represents the SourceDescription passed to the player.
    // return true -> the Media3 integration pipline will be used to play the selected source.
    // return false -> the default pipeline will be used to play the selected source.
})
theoplayerView.player.addIntegration(media3PlayerIntegration);
```

## More information

- [API references](pathname:///theoplayer/v8/api-reference/android/com/theoplayer/android/api/media3/package-summary.html)
