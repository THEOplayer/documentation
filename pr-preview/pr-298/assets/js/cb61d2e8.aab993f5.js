"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([["23290"],{27225:function(e,t,i){i.r(t),i.d(t,{default:()=>h,frontMatter:()=>s,metadata:()=>o,assets:()=>a,toc:()=>c,contentTitle:()=>l});var o=JSON.parse('{"id":"distribution/stream-recordings/how-to-setup-media-storage","title":"How-to Setup Storage Profiles","description":"With Live Clipping you can have clips stored directly to your preferred third-party cloud storage provider. This gives you additional control over storage costs and manage usage of media clips.","source":"@site/millicast/distribution/stream-recordings/how-to-setup-media-storage.md","sourceDirName":"distribution/stream-recordings","slug":"/distribution/stream-recordings/how-to-setup-media-storage","permalink":"/documentation/pr-preview/pr-298/millicast/distribution/stream-recordings/how-to-setup-media-storage","draft":false,"unlisted":false,"editUrl":"https://github.com/THEOplayer/documentation/blob/-/millicast/distribution/stream-recordings/how-to-setup-media-storage.md","tags":[],"version":"current","frontMatter":{"title":"How-to Setup Storage Profiles"},"sidebar":"millicast","previous":{"title":"How-to Get Media Assets","permalink":"/documentation/pr-preview/pr-298/millicast/distribution/stream-recordings/how-to-get-media-assets"},"next":{"title":"How-to Start Live Clipping","permalink":"/documentation/pr-preview/pr-298/millicast/distribution/stream-recordings/live-clipping"}}'),r=i("85893"),n=i("50065");let s={title:"How-to Setup Storage Profiles"},l=void 0,a={},c=[{value:"Configuring Account Storage Profile",id:"configuring-account-storage-profile",level:2},{value:"How-to Validate the Storage Profile",id:"how-to-validate-the-storage-profile",level:3},{value:"Setting Up Cloud Storage",id:"setting-up-cloud-storage",level:2},{value:"Google Cloud Storage",id:"google-cloud-storage",level:3},{value:"How-to Grant Authorization to a Bucket",id:"how-to-grant-authorization-to-a-bucket",level:4},{value:"AWS S3",id:"aws-s3",level:3},{value:"How-to Set the Bucket Policy",id:"how-to-set-the-bucket-policy",level:4}];function d(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["With ",(0,r.jsx)(t.a,{href:"/documentation/pr-preview/pr-298/millicast/distribution/stream-recordings/live-clipping",children:"Live Clipping"})," you can have clips stored directly to your preferred third-party cloud storage provider. This gives you additional control over storage costs and manage usage of media clips."]}),"\n",(0,r.jsxs)(t.admonition,{title:"Not Available for Recordings",type:"caution",children:[(0,r.jsxs)(t.p,{children:["At this time, ",(0,r.jsx)(t.a,{href:"/documentation/pr-preview/pr-298/millicast/distribution/stream-recordings/start-recording",children:"Recordings"})," cannot be configured to use a third-party cloud storage provider directly. You should follow the ",(0,r.jsx)(t.a,{href:"/documentation/pr-preview/pr-298/millicast/distribution/stream-recordings/how-to-get-media-assets",children:"How-to Get Media Assets"})," guide to identify recordings for download and then you can upload them to your preferred provider of choice."]}),(0,r.jsxs)(t.p,{children:["Similarly, ",(0,r.jsx)(t.strong,{children:"timelines"})," will always be stored in Dolby's storage subject to expiration rules."]})]}),"\n",(0,r.jsx)(t.h2,{id:"configuring-account-storage-profile",children:"Configuring Account Storage Profile"}),"\n",(0,r.jsxs)(t.p,{children:["You can start by adding a ",(0,r.jsx)(t.strong,{children:"storage profile"})," that will persist across the account so that you can reuse the configuration by name on all future ",(0,r.jsx)(t.a,{href:"/documentation/pr-preview/pr-298/millicast/api/media-assets-create-media-asset",children:"Create Clip"})," requests or as the default setting."]}),"\n",(0,r.jsxs)(t.p,{children:["Use the ",(0,r.jsx)(t.a,{href:"/documentation/pr-preview/pr-298/millicast/api/account-create-storage-profile",children:"Create Account Storage Profile"})," endpoint to create a new storage profile."]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"name"}),": The label you can use to reference the profile."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"default"}),": Whether to use this storage profile for all future requests as the default setting."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"type"}),": Configuration for S3 or GCS storage locations."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"options"}),": Additional configuration specific for each storage provider","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"bucketName"}),": the name of the bucket"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"objectPrefix"}),": similar to a folder path to help organize clips"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"bucketRegion"}),": the region to use with your storage provider (optional)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["The storage profile will have a unique ",(0,r.jsx)(t.code,{children:"profileId"})," that is an assigned GUID that can be used in clipping requests. You do ",(0,r.jsx)(t.em,{children:"not"})," need to include the protocol ",(0,r.jsx)(t.code,{children:"s3://"})," or ",(0,r.jsx)(t.code,{children:"gs://"})," in this configuration as that is indicated by the ",(0,r.jsx)(t.strong,{children:"type"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"Your choice of storage provider may have a limitation on allowed characters for object names. You should follow the same guidelines when choosing clip naming rules."}),"\n",(0,r.jsx)(t.h3,{id:"how-to-validate-the-storage-profile",children:"How-to Validate the Storage Profile"}),"\n",(0,r.jsxs)(t.p,{children:["Use the ",(0,r.jsx)(t.a,{href:"/documentation/pr-preview/pr-298/millicast/api/account-validate-third-party-storage",children:"Validate Third Party Storage Setup"})," endpoint to test whether or not a storage profile is properly configured. This will transfer a small test file to make sure that it can be written to your cloud storage provider."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-curl",children:'curl --request POST \\\n  --url https://api.millicast.com/api/v3/account/media/storage/validate \\\n  --header \'authorization: Bearer abc123\' \\\n  --data \'\n{\n  "profileId": "xz23dk75fb4ac6a2949c39ef454a885adkde",\n  "type": "gcs",\n  "options": {\n    "objectPrefix": "/streams/clips",\n    "bucketName": "my-org-bucket"\n  }\n}\n\'\n'})}),"\n",(0,r.jsx)(t.h2,{id:"setting-up-cloud-storage",children:"Setting Up Cloud Storage"}),"\n",(0,r.jsx)(t.p,{children:"Dolby storage is used by default, but to use your own storage you will need to provide authorization to access."}),"\n",(0,r.jsx)(t.h3,{id:"google-cloud-storage",children:"Google Cloud Storage"}),"\n",(0,r.jsx)(t.p,{children:"For the storage profile use the following settings:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Key"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"type"}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Identify the storage provider, specifically ",(0,r.jsx)(t.strong,{children:"gcs"}),"."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"bucketName"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"The name of the bucket you want to use for storing clips. You can create multiple storage profiles if you have more than one bucket."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"objectPrefix"}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Each object has a ",(0,r.jsx)(t.strong,{children:"gsutil URI"})," file path that contains an object prefix to use. You can find this from your Google Cloud Storage configuration ",(0,r.jsx)(t.strong,{children:"Objects"})," tab for a specific bucket."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"bucketRegion"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"(optional) To specify a specific cloud region. Typically not used for Google Cloud Storage."})]})]})]}),"\n",(0,r.jsx)(t.p,{children:"Configuration:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Cloud Provider"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Service Account"})]})}),(0,r.jsx)(t.tbody,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Google Cloud Storage"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"millicast-recording-service@millicast.iam.gserviceaccount.com"})})]})})]}),"\n",(0,r.jsx)(t.h4,{id:"how-to-grant-authorization-to-a-bucket",children:"How-to Grant Authorization to a Bucket"}),"\n",(0,r.jsx)(t.p,{children:"The following procedure explains how to grant Dolby upload access to Google Cloud Storage buckets. Upon completion, the Dolby service account will have the storage object creator role for the selected storage bucket."}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Log in to your GCP account."}),"\n",(0,r.jsxs)(t.li,{children:["Within your GCP console, navigate to the bucket you wish to grant access to Dolby.io and select the ",(0,r.jsx)(t.strong,{children:"Permissions"})," tab."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:i(15324).Z+"",width:"3456",height:"1806"})}),"\n",(0,r.jsxs)(t.ol,{start:"3",children:["\n",(0,r.jsxs)(t.li,{children:["Click the ",(0,r.jsx)(t.strong,{children:"Grant Access"})," link."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:i(91256).Z+"",width:"3456",height:"1806"})}),"\n",(0,r.jsxs)(t.ol,{start:"4",children:["\n",(0,r.jsxs)(t.li,{children:["On the side panel that appears, enter the Dolby.io service account email ",(0,r.jsx)(t.code,{children:"millicast-recording-service@millicast.iam.gserviceaccount.com"})," into the ",(0,r.jsx)(t.strong,{children:"New Principals"})," text box, and select the ",(0,r.jsx)(t.strong,{children:"Storage Object Creator"})," role. These are the minimum recommended permissions for enabling reliable upload access to your storage bucket."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:i(70599).Z+"",width:"3456",height:"1806"})}),"\n",(0,r.jsxs)(t.ol,{start:"5",children:["\n",(0,r.jsxs)(t.li,{children:["Click ",(0,r.jsx)(t.strong,{children:"Save"})," to confirm the provided details."]}),"\n",(0,r.jsx)(t.li,{children:"Check if the newly added service account is visible on the permissions list."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:i(68524).Z+"",width:"3456",height:"1806"})}),"\n",(0,r.jsx)(t.h3,{id:"aws-s3",children:"AWS S3"}),"\n",(0,r.jsx)(t.p,{children:"To configure Amazon's Simple Storage Service (S3) you need to provide authorization to our service."}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Create an AWS S3 Bucket. See the official ",(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/creating-bucket.html",children:"AWS Getting Started"})," docs for instructions."]}),"\n",(0,r.jsx)(t.li,{children:"Update the bucket policy with credentials that permit Dolby to read and put objects."}),"\n"]}),"\n",(0,r.jsx)(t.h4,{id:"how-to-set-the-bucket-policy",children:"How-to Set the Bucket Policy"}),"\n",(0,r.jsxs)(t.p,{children:["Visit the official AWS ",(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/add-bucket-policy.html",children:"Adding a bucket policy"})," documentation for instructions."]}),"\n",(0,r.jsxs)(t.p,{children:["Be sure to substitute the name of the bucket in the placeholder field ",(0,r.jsx)(t.code,{children:"${BUCKET_NAME}"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",metastring:'title="Policy"',children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Sid": "allow-dolby-write",\n      "Effect": "Allow",\n      "Principal": {\n        "AWS": ["arn:aws:iam::548863597864:role/millicast-recording-service"]\n      },\n      "Action": "s3:PutObject*",\n      "Resource": "arn:aws:s3:::${BUCKET_NAME}/*"\n    }\n  ]\n}\n'})})]})}function h(e={}){let{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},15324:function(e,t,i){i.d(t,{Z:function(){return o}});let o=i.p+"assets/images/Screenshot_2024-02-14_at_2.30.39_pm-89ce1c4e7184043ef1e3cfe912ddf6c6.png"},91256:function(e,t,i){i.d(t,{Z:function(){return o}});let o=i.p+"assets/images/Screenshot_2024-02-14_at_2.35.17_pm-9593ea2aed583695c0f829a2eb6436cb.png"},70599:function(e,t,i){i.d(t,{Z:function(){return o}});let o=i.p+"assets/images/Screenshot_2024-02-14_at_2.37.07_pm-f6ef119f5055168f9f1a30b4af1e1ae6.png"},68524:function(e,t,i){i.d(t,{Z:function(){return o}});let o=i.p+"assets/images/Screenshot_2024-02-14_at_2.41.23_pm-088fcc30c0a6c8dfc66a9324a9906219.png"},50065:function(e,t,i){i.d(t,{Z:function(){return l},a:function(){return s}});var o=i(67294);let r={},n=o.createContext(r);function s(e){let t=o.useContext(n);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(n.Provider,{value:t},e.children)}}}]);