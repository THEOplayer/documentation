"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([["51221"],{952131(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>l});var t=s(373870),i=s(474848),r=s(28453);let a={},o="Playing ads with THEOplayer Roku SDK",d={},l=[{value:"First Steps",id:"first-steps",level:2},{value:"Client-side Ad Insertion",id:"client-side-ad-insertion",level:2},{value:"Create your ad descriptions",id:"create-your-ad-descriptions",level:3},{value:"Mixing VAST and VMAP Ads",id:"mixing-vast-and-vmap-ads",level:4},{value:"Listen for ad events",id:"listen-for-ad-events",level:3},{value:"Monitoring RAF",id:"monitoring-raf",level:3},{value:"Scheduling Ads at Runtime",id:"scheduling-ads-at-runtime",level:3},{value:"Limitations",id:"limitations",level:3},{value:"Server-side Ad Insertion",id:"server-side-ad-insertion",level:2},{value:"Google IMA Streams",id:"google-ima-streams",level:3},{value:"THEOlive and THEOads",id:"theolive-and-theoads",level:3},{value:"Listening for Ad Events",id:"listening-for-ad-events",level:3}];function c(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"playing-ads-with-theoplayer-roku-sdk",children:"Playing ads with THEOplayer Roku SDK"})}),"\n",(0,i.jsx)(n.p,{children:"This article will provide the steps needed to play video ads with your content using the THEOplayer Roku SDK. The THEOplayer Roku SDK currently only supports Client-side Ad Insertion (CSAI) for VOD assets and some Server-side Ad Insertion (SSAI) using Google Ad Manager or THEOads. It does not yet support Client-side Ad Stitching (CSAS), Server Guided Ad Insertion (SGAI) or live CSAI ads."}),"\n",(0,i.jsx)(n.h2,{id:"first-steps",children:"First Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Make sure you are using a version of the SDK that supports ads. CSAI is available for VOD content in v9.3 and higher of the SDK. SSAI with Google IMA is available starting in v10.3."}),"\n",(0,i.jsxs)(n.li,{children:["Include the RAF advertising library in your application's manifest file by adding this line:\n",(0,i.jsx)(n.code,{children:"bs_libs_required=roku_ads_lib"})]}),"\n",(0,i.jsxs)(n.li,{children:["To support Google DAI, include the Google IMA library as well by adding ",(0,i.jsx)(n.code,{children:"googleima3"})," after the RAF ads library:\n",(0,i.jsx)(n.code,{children:"bs_libs_required=roku_ads_lib,googleima3"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"client-side-ad-insertion",children:"Client-side Ad Insertion"}),"\n",(0,i.jsxs)(n.p,{children:["The THEOplayer Roku SDK supports CSAI by using the Roku Advertising Framework (RAF), which is provided by Roku. It supports VMAP and VAST ad tags. For more information about specific features of VAST or VMAP supported by RAF, please visit their ",(0,i.jsx)(n.a,{href:"https://developer.roku.com/docs/developer-program/advertising/roku-advertising-framework.md",children:"support page"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"create-your-ad-descriptions",children:"Create your ad descriptions"}),"\n",(0,i.jsxs)(n.p,{children:["Ads are added to your content by adding ad sources to your source descriptions that are set on the ",(0,i.jsx)(n.code,{children:"source"})," property of the THEOplayer. Here is an example for VAST ad tags:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-brightscript",children:'m.player.source = {\n    "title": "My VOD Asset",\n    "live": false,\n    "sources": {\n        "src": "https://example.com/my_vod_asset.m3u8",\n        "type": "application/x-mpegurl"\n    },\n    "ads": [\n        {\n            integration: "csai",\n            sources: "https://exampleadserver.com/preroll.xml",\n            timeOffset: "start"\n        },\n        {\n            integration: "csai",\n            sources: "https://exampleadserver.com/midroll.xml",\n            timeOffset: 30\n        },\n        {\n            integration: "csai",\n            sources: "https://exampleadserver.com/midroll2.xml",\n            timeOffset: 190\n        },\n        {\n            integration: "csai",\n            sources: "https://exampleadserver.com/postroll.xml",\n            timeOffset: "end"\n        }\n    ]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"For VMAP ads, the timing is contained within the VMAP file itself, so the configuration is simpler:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-brightscript",children:'m.player.source = {\n    "title": "My VOD Asset",\n    "live": false,\n    "sources": {\n        "src": "https://example.com/my_vod_asset.m3u8",\n        "type": "application/x-mpegurl"\n    },\n    "ads": [\n        {\n            integration: "csai",\n            sources: "https://exampleadserver.com/vmap.xml",\n        }\n    ]\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Note that the ",(0,i.jsx)(n.code,{children:"timeOffset"})," property must be omitted for VMAP ads."]}),"\n",(0,i.jsxs)(n.p,{children:["You may also specify the timings for VAST ads either by using a timecode or by specifying the percent of the asset that should play before displaying the ad. Timecodes should be in the format ",(0,i.jsx)(n.code,{children:"HH:MM:SS"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-brightscript",children:'m.player.source = {\n    "title": "My VOD Asset",\n    "live": false,\n    "sources": {\n        "src": "https://example.com/my_vod_asset.m3u8",\n        "type": "application/x-mpegurl"\n    },\n    "ads": [\n        {\n            integration: "csai",\n            sources: "https://exampleadserver.com/midroll.xml",\n            timeOffset: "00:05:30"\n        },\n        {\n            integration: "csai",\n            sources: "https://exampleadserver.com/midroll2.xml",\n            timeOffset: "25%"\n        }\n    ]\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"mixing-vast-and-vmap-ads",children:"Mixing VAST and VMAP Ads"}),"\n",(0,i.jsx)(n.p,{children:"Mixing VAST and VMAP ads is supported to an extent. A VMAP tag may contain multiple ad breaks. VAST tags may not be scheduled in between any of the breaks in a single VMAP tag. So, for instance, if you have a VMAP tag that contains a preroll and a postroll, you could not schedule any VAST midrolls between those breaks. However, if the preroll and postroll were in separate VMAP tags, you could schedule a midroll in between them."}),"\n",(0,i.jsx)(n.h3,{id:"listen-for-ad-events",children:"Listen for ad events"}),"\n",(0,i.jsxs)(n.p,{children:["To detect events emitted for the ads, you can call the ",(0,i.jsx)(n.code,{children:"addEventListener"})," method on the Ads API. You can see the list of ad events on ",(0,i.jsx)(n.a,{href:"/documentation/pr-preview/pr-521/theoplayer/api-reference/roku#ads-api",children:"the API reference page"}),". Note that the method used for the listener needs to be exposed through the interface of the node that owns the listener function."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-brightscript",children:'adEvents = m.player.ads.events\nm.player.ads.callFunc("addEventListener", adEvents.adbreakbegin, m.top, "onAdBreakBegin")\nm.player.ads.callFunc("addEventListener", adEvents.adbreakend, m.top, "onAdBreakEnd")\n'})}),"\n",(0,i.jsxs)(n.p,{children:["To clean up, you can simply call ",(0,i.jsx)(n.code,{children:"removeEventListener"})," the same way."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-brightscript",children:'m.player.ads.callFunc("removeEventListener", adEvents.adbreakbegin, m.top, "onAdBreakBegin")\nm.player.ads.callFunc("removeEventListener", adEvents.adbreakend, m.top, "onAdBreakEnd")\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Also, if you just want to see whether ads are playing or not, observe the ",(0,i.jsx)(n.code,{children:"playing"})," field on the Ads API. You can see the other fields available on ",(0,i.jsx)(n.a,{href:"/documentation/pr-preview/pr-521/theoplayer/api-reference/roku#ads-api",children:"the API reference page"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-brightscript",children:'m.player.ads.observeField("playing", "onAdsPlayingChange")\n\nsub onAdsPlayingChange( event as object )\n    adsPlaying = event.getData()\nend sub\n'})}),"\n",(0,i.jsx)(n.h3,{id:"monitoring-raf",children:"Monitoring RAF"}),"\n",(0,i.jsxs)(n.p,{children:["The THEOplayer Roku SDK does not expose RAF directly. However, you can still get the data from RAF's callbacks for tracking, buffering, and library version. On the Ads API, there is the ",(0,i.jsx)(n.code,{children:"rafProxy"})," node. This field exposes data from RAF on fields of its own. To substitute for the output from RAF's ",(0,i.jsx)(n.code,{children:"setTrackingCallback"})," method, you could do the following:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-brightscript",children:'m.player.ads.rafProxy.observeField("trackingUpdate", "onRafTrackingUpdate")\n\nsub onRafTrackingUpdate(event as object)\n    update = event.getData()\n    m.myRafObserver.rafTrackingCallback(m.myRafObserver, update.eventType, update.ctx)\nend sub\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Similarly, you can listen for RAF's ",(0,i.jsx)(n.code,{children:"setAdBufferRenderCallback"})," output by observing the ",(0,i.jsx)(n.code,{children:"bufferRenderUpdate"})," field on the Ads API."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-brightscript",children:'m.player.ads.rafProxy.observeField("bufferRenderUpdate", "onRafBufferUpdate")\n\nsub onRafBufferUpdate(event as object)\n    update = event.getData()\n    m.myRafObserver.rafBufferingCallback(m.myRafObserver, update.eventType, update.ctx)\nend sub\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"rafProxy"})," field also exposes the library version of RAF via its own ",(0,i.jsx)(n.code,{children:"libVersion"})," field."]}),"\n",(0,i.jsx)(n.h3,{id:"scheduling-ads-at-runtime",children:"Scheduling Ads at Runtime"}),"\n",(0,i.jsxs)(n.p,{children:["If you need to add an ad break to your asset when the asset has already begun playing, you can use the ",(0,i.jsx)(n.code,{children:"schedule"})," method on the Ads API. It takes an ad description as the parameter. It will return a true or false value, based on whether adding the ad appears to have succeeded. In some cases when adding VMAP, it may not be able to report accurately whether the ad break was added or not. In that case you can observe the ",(0,i.jsx)(n.code,{children:"scheduledAdBreaks"})," property to see if the ad break was correctly added."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-brightscript",children:'adDesc = {\n    integration: "csai",\n    sources: "https://exampleadserver.com/midroll.xml",\n    timeOffset: "00:05:30"\n}\nsuccess = m.player.ads.callFunc("schedule", adDesc)\n'})}),"\n",(0,i.jsx)(n.p,{children:"There are some restrictions on what you can schedule:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["You cannot schedule preroll ads via the ",(0,i.jsx)(n.code,{children:"schedule"})," method."]}),"\n",(0,i.jsx)(n.li,{children:"You cannot schedule an ad at the same time as an already scheduled ad."}),"\n",(0,i.jsx)(n.li,{children:"You cannot schedule a VMAP before any previously scheduled breaks, unless that previously scheduled break is a VAST postroll."}),"\n",(0,i.jsx)(n.li,{children:"If you schedule a VMAP midroll after it would have already played, it will play immediately."}),"\n",(0,i.jsx)(n.li,{children:"You cannot schedule a midroll in between ad breaks that are in the same VMAP tag."}),"\n",(0,i.jsx)(n.li,{children:"You cannot schedule a midroll before a previously scheduled VMAP tag."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"limitations",children:"Limitations"}),"\n",(0,i.jsx)(n.p,{children:"Currently the Ads API does not support:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Playing VAST tags in the middle of breaks from a VMAP tag."}),"\n",(0,i.jsx)(n.li,{children:"Reporting the exact media file that is being played for a creative."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"server-side-ad-insertion",children:"Server-side Ad Insertion"}),"\n",(0,i.jsx)(n.p,{children:"The THEOplayer Roku SDK supports SSAI by using the Google IMA library, which is provided by Roku and can be added in your application's manifest file. It supports SSAI through two methods: Google-registered streams and THEOlive streams with THEOads."}),"\n",(0,i.jsx)(n.h3,{id:"google-ima-streams",children:"Google IMA Streams"}),"\n",(0,i.jsxs)(n.p,{children:["To play a DAI stream that is registered with Google IMA, add an ",(0,i.jsx)(n.code,{children:"ssai"})," config on the source description you pass to the THEOplayer. Set the ",(0,i.jsx)(n.code,{children:"src"})," property of the ",(0,i.jsx)(n.code,{children:"sources"})," object to an arbitrary, non-empty string and set the ",(0,i.jsx)(n.code,{children:"type"})," to the MIME type for the manifest. Then fill in your Google DAI information in the ",(0,i.jsx)(n.code,{children:"ssai"})," config, making sure to set the ",(0,i.jsx)(n.code,{children:"integration"})," property of the ",(0,i.jsx)(n.code,{children:"ssai"})," config to ",(0,i.jsx)(n.code,{children:'"google-dai"'}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-brightscript",children:'m.player.source = {\n    "title": "Google DAI Stream",\n    "sources": {\n        "src": "ssai",\n        "type": "application/x-mpegurl",\n        "ssai": {\n            integration: "google-dai",\n            availabilityType: "live",\n            assetKey: "<MY_ASSET_KEY>",\n            networkCode: "<MY_NETWORK_CODE>",\n            apiKey: "<MY_API_KEY>",\n        },\n    }\n},\n'})}),"\n",(0,i.jsx)(n.h3,{id:"theolive-and-theoads",children:"THEOlive and THEOads"}),"\n",(0,i.jsxs)(n.p,{children:["To play a THEOlive SSAI stream that is configured in THEOlive to use THEOads with Google IMA, add an ",(0,i.jsx)(n.code,{children:"ssai"})," config on the source description you pass to the THEOplayer. Set the ",(0,i.jsx)(n.code,{children:"src"})," property of the ",(0,i.jsx)(n.code,{children:"sources"})," object to your THEOlive distribution ID and set the ",(0,i.jsx)(n.code,{children:"type"})," to ",(0,i.jsx)(n.code,{children:'"theolive"'}),". Then on the ",(0,i.jsx)(n.code,{children:"ssai"})," config, set the ",(0,i.jsx)(n.code,{children:"integration"})," property to ",(0,i.jsx)(n.code,{children:'"theoads"'}),". You may additionally add ad tag parameters for Google IMA by setting the ",(0,i.jsx)(n.code,{children:"adTagParameters"})," property of the ",(0,i.jsx)(n.code,{children:"ssai"})," config to an associative array with the URL params as properties and values."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-brightscript",children:'m.player.source = {\n    "title": "THEOlive DAI Stream",\n    "sources": {\n        "src": "<MY_THEOLIVE_DISTRIBUTION_ID>",\n        "type": "theolive",\n        "ssai": {\n            integration: "theoads",\n            adTagParameters: {\n                "iu": "<MY_IU_VALUE>"\n            }\n        }\n    }\n},\n'})}),"\n",(0,i.jsx)(n.h3,{id:"listening-for-ad-events",children:"Listening for Ad Events"}),"\n",(0,i.jsx)(n.p,{children:"With SSAI, the AdsAPI still will emit ad beacon events. You can add listeners for these ad events on the AdsAPI just like CSAI by following the instructions in the CSAI section. Unfortunately, monitoring RAF via the RAF proxy is not available for SSAI."})]})}function h(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453(e,n,s){s.d(n,{R:()=>a,x:()=>o});var t=s(296540);let i={},r=t.createContext(i);function a(e){let n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}},373870(e){e.exports=JSON.parse('{"id":"getting-started/sdks/roku/displaying-ads","title":"Playing ads with THEOplayer Roku SDK","description":"This article will provide the steps needed to play video ads with your content using the THEOplayer Roku SDK. The THEOplayer Roku SDK currently only supports Client-side Ad Insertion (CSAI) for VOD assets and some Server-side Ad Insertion (SSAI) using Google Ad Manager or THEOads. It does not yet support Client-side Ad Stitching (CSAS), Server Guided Ad Insertion (SGAI) or live CSAI ads.","source":"@site/theoplayer/getting-started/01-sdks/09-roku/02-displaying-ads.md","sourceDirName":"getting-started/01-sdks/09-roku","slug":"/getting-started/sdks/roku/displaying-ads","permalink":"/documentation/pr-preview/pr-521/theoplayer/getting-started/sdks/roku/displaying-ads","draft":false,"unlisted":false,"editUrl":"https://github.com/THEOplayer/documentation/blob/-/theoplayer/getting-started/01-sdks/09-roku/02-displaying-ads.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"roku","previous":{"title":"Migrating to THEOplayer Roku SDK 10.x","permalink":"/documentation/pr-preview/pr-521/theoplayer/getting-started/sdks/roku/migrating-to-theoplayer-10"},"next":{"title":"How-to guides","permalink":"/documentation/pr-preview/pr-521/theoplayer/how-to-guides/"}}')}}]);