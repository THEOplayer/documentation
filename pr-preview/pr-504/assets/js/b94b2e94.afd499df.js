"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([["1167"],{892772(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>d});var o=t(917702),r=t(474848),i=t(28453);let a={},s="Token based security",l={},d=[{value:"Setting up the Roku THEOplayer SDK for THEOlive",id:"setting-up-the-roku-theoplayer-sdk-for-theolive",level:2},{value:"Configuring THEOplayer to pass the token",id:"configuring-theoplayer-to-pass-the-token",level:2},{value:"Dealing with token expiry and rotation",id:"dealing-with-token-expiry-and-rotation",level:2},{value:"Clearing the token",id:"clearing-the-token",level:2}];function c(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"token-based-security",children:"Token based security"})}),"\n",(0,r.jsxs)(n.p,{children:["THEOlive offers the option to enable JWT token security on channel distribution level. This can be interesting if you only want valid users to access your stream. Read more about the feature and configuring it on your channels on the ",(0,r.jsx)(n.a,{href:"/theolive/platform/security/token-based-security",children:"token based security guide"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"This page will demonstrate how to configure the Roku Player SDK for playback of channels with token based security enabled."}),"\n",(0,r.jsx)(n.h2,{id:"setting-up-the-roku-theoplayer-sdk-for-theolive",children:"Setting up the Roku THEOplayer SDK for THEOlive"}),"\n",(0,r.jsxs)(n.p,{children:["Refer to the ",(0,r.jsx)(n.a,{href:"../getting-started",children:"getting started guide"})," for the prerequisite steps in getting the Roku SDK up and running for THEOlive playback."]}),"\n",(0,r.jsx)(n.h2,{id:"configuring-theoplayer-to-pass-the-token",children:"Configuring THEOplayer to pass the token"}),"\n",(0,r.jsx)(n.p,{children:"The THEOlive API provides a simple property to configure your token:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-brightscript",children:"token = getToken() // Generate or request your token, for more information check the token based security guide linked above.\nplayer.theolive.authToken = token\n"})}),"\n",(0,r.jsx)(n.p,{children:"This will ensure the player includes your token in the authorization header on all subsequent requests it performs for playback of your THEOlive channel."}),"\n",(0,r.jsx)(n.h2,{id:"dealing-with-token-expiry-and-rotation",children:"Dealing with token expiry and rotation"}),"\n",(0,r.jsx)(n.p,{children:"If your tokens are short-lived, you want to make sure to update the token being passed to the player and requests before it expires, to allow playback to continue beyond expiry. This can simply be done by updating the header on the player in the same way. For example, one could check on an interval that makes sense for your token lifespan whether the token is about to expire and update when necessary, for example:"}),"\n",(0,r.jsx)(n.p,{children:"Add a Timer to your SceneGraph component to check the token at an interval:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-brightscript",children:'...\n  <children>\n    <Timer id="tokenTimer" repeat="true" duration="30" />\n  </children>\n...\n'})}),"\n",(0,r.jsx)(n.p,{children:"And in your Brightscript code:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-brightscript",children:'sub init()\n    ...\n\n    m.token = ""\n    m.player = getPlayer()\n\n    maybeUpdateToken()\n    m.tokenTimer = m.top.findNode("tokenTimer")\n    m.tokenTimer.observeField("fire", "maybeUpdateToken")\n    m.tokenTimer.control = "start"\nend sub\n\nsub maybeUpdateToken()\n    if m.token = "" or tokenWillExpireSoon(m.token) then\n        m.token = getToken() \' Generate or request your token, for more information check the token based security guide linked above.\n        m.player.theolive.authToken = m.token\n    end if\nend sub\n\nfunction tokenWillExpireSoon(token as String) as Boolean\n    parts = token.split(".")\n    if parts.count() < 2 then return true\n\n    payloadBase64 = parts[1]\n    ba = CreateObject("roByteArray")\n    ba.FromBase64String(payloadBase64)\n    decodedJson = ParseJson(ba.ToAsciiString())\n    if decodedJson = invalid then return true\n\n    exp = decodedJson.exp\n    if exp = invalid then return true\n    now = Int(CreateObject("roDateTime").AsSeconds())\n\n    return exp - now <= 60\nend function\n'})}),"\n",(0,r.jsx)(n.h2,{id:"clearing-the-token",children:"Clearing the token"}),"\n",(0,r.jsx)(n.p,{children:"If the token isn't needed anymore, e.g. when switching to an unprotected channel or a non-THEOlive source altogether, the header can be simply removed as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-brightscript",children:'player.theolive.authToken = ""\n'})})]})}function u(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},28453(e,n,t){t.d(n,{R:()=>a,x:()=>s});var o=t(296540);let r={},i=o.createContext(r);function a(e){let n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(i.Provider,{value:n},e.children)}},917702(e){e.exports=JSON.parse('{"id":"playback/roku/token-based-security","title":"Token based security","description":"THEOlive offers the option to enable JWT token security on channel distribution level. This can be interesting if you only want valid users to access your stream. Read more about the feature and configuring it on your channels on the token based security guide.","source":"@site/theolive/playback/roku/01-token-based-security.mdx","sourceDirName":"playback/roku","slug":"/playback/roku/token-based-security","permalink":"/documentation/pr-preview/pr-504/theolive/playback/roku/token-based-security","draft":false,"unlisted":false,"editUrl":"https://github.com/THEOplayer/documentation/blob/-/theolive/playback/roku/01-token-based-security.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"theolive","previous":{"title":"Getting started with Roku","permalink":"/documentation/pr-preview/pr-504/theolive/playback/roku/getting-started"},"next":{"title":"Migrating to THEOlive v2","permalink":"/documentation/pr-preview/pr-504/theolive/playback/roku/migrating-to-v2"}}')}}]);